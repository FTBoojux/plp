# 说明
本次更新引入了对 `form-data` 和 `form-urlencoded` 格式的请求，并支持通过 `form-data` 进行文件传输

## 请求处理的调整

增加了 `BodyParser` 接口和 `BodyParserFactory` 工厂类，根据 `Content-Type` 的不同，返回不同的处理器，对携带的数据进行解析。

## `BodyParser`的定义

```java
public interface BodyParser {
    Pair<FormData, Object> extractBodyData(InputStream inputStream, HttpHeaders headers, @Optional RequestHandler<?> requestHandler) throws IOException;
}
```

## FormData
`form-data` 和 `form-urlencoded` 格式的数据，转换后存放在 `HttpRequest.formData` 中

### FormData中的方法

| Modifier and Type | Method                                | Description                                |
|-------------------|---------------------------------------|--------------------------------------------|
| FormData          | newInstance()                         | 创建一个新的 `FormData` 对象                       |
| void              | put(String key, T value)              | 把 `value` 添加到 `key` 对应的列表的尾部               |
| Object            | getFirstObject(String key)            | 获取 `key` 的列表的第一个元素，如果为空则返回null             |
| List<Object>      | getAll(String key)                    | 获取 `key` 对应的列表中的所有成员                       |
| List<T>           | getAll(String key, Class<T> clz)      | 获取 `key` 对应的列表中的所有成员，并将其转换为指定的类型           |
| List<T>           | getAll(String key,TypeReference type) | 获取 `key` 对应的列表中的所有成员，并将其转换为指定的类型           |
| String            | getString(String key)                 | 获取 `key` 对应的列表中的首个成员，并将其转换为String类型        |
| Integer           | getInteger(String key)                | 获取 `key` 对应的列表中的首个成员，并将其转换为Integer类型       |
| Boolean           | getBoolean(String key)                | 获取 `key` 对应的列表中的首个成员，并将其转换为Boolean类型       |
| Long              | getLong(String key)                   | 获取 `key` 对应的列表中的首个成员，并将其转换为Long类型          |
| Double            | getDouble(String key)                 | 获取 `key` 对应的列表中的首个成员，并将其转换为Double类型        |
| Float             | getFloat(String key)                  | 获取 `key` 对应的列表中的首个成员，并将其转换为Float类型         |
| MultipartFile     | getMultipartFile(String key)          | 获取 `key` 对应的列表中的首个成员，并将其转换为MultipartFile类型 |

### 使用示例

```java
    @Override
    public Object doHandle(HttpRequest<Void> httpRequest) {
        FormData formData = httpRequest.getFormData();
        String username = formData.getString("username");
        if (usernames.contains(username)){
            return "{\"msg\":\"this username had been used!\"}";
        }
        return "{\"msg\":\"this username is valid!\"}";
    }
```

```java
    @Override
    public Object doHandle(HttpRequest<Void> httpRequest) {
        MultipartFile file = httpRequest.getFormData().getMultipartFile("file");
        String tempFile = tempDir
                + System.currentTimeMillis() +
                file.getFilename().substring(file.getFilename().lastIndexOf('.'));
        File fileTarget = new File(tempFile);
        fileTarget.deleteOnExit();
        try {
            FileOutputStream outputStream = new FileOutputStream(fileTarget);
            outputStream.write(file.getBytes());
            outputStream.flush();
            outputStream.close();
        } catch (IOException e) {
            throw new RuntimeException(e);
        }
        return "ok";
    }
```