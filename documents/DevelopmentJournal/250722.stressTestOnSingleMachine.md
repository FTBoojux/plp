# 对现有的单线程while循环服务器进行了简单的单机压力测试

### 测试环境：
处理器： Intel(R) Core(TM) Ultra 7 155H   1.40 GHz
内存： 32.0 GB (31.6 GB 可用)
操作系统： Windows 11 专业工作站版（版本号：26100.3476）
JDK 版本： Oracle OpenJDK 23.0.2

### 测试用注册路由

```java
public class Main {
    public static void main(String[] args) throws IOException {
        WebClient.build()
                .bind(8000)
                .addHandler(new HealthCheckHandler())
                .addHandler(new QuestionParamHandler())
                .addHandler(new PathVariableHandler())
                .listen();
    }
}
```

### 测试流程
- 通过预先发送100个请求对系统进行预热
- 后逐步提升请求的频率
- 至高提升到60（每个线程生成60个，线程数去cpu核数的一半）
- 对静态路径和动态路径分别进行测试

### 静态路径测试结果

```text
++++++++++++++++++++++++++++++++++++++++++++++++++
run all tests:org.example.web.WebClientStressTest
--------------------------------------------------
--------------------------------------------------
=== Stress Test Results ===
Total requests: 10
Successful requests: 10
Total test time: 4ms
Requests per second: 2500.0
Average response time: 3.3ms
Min response time: 2ms
Max response time: 4ms
50th percentile: 4ms
90th percentile: 4ms
++++++++++++++++++++++++++++++++++++++++++++++++++
=== Stress Test Results ===
Total requests: 20
Successful requests: 20
Total test time: 5ms
Requests per second: 4000.0
Average response time: 3.2ms
Min response time: 1ms
Max response time: 5ms
50th percentile: 3ms
90th percentile: 5ms
++++++++++++++++++++++++++++++++++++++++++++++++++
=== Stress Test Results ===
Total requests: 30
Successful requests: 30
Total test time: 10ms
Requests per second: 3000.0
Average response time: 5.366666666666666ms
Min response time: 2ms
Max response time: 9ms
50th percentile: 5ms
90th percentile: 8ms
++++++++++++++++++++++++++++++++++++++++++++++++++
=== Stress Test Results ===
Total requests: 40
Successful requests: 40
Total test time: 10ms
Requests per second: 4000.0
Average response time: 5.7ms
Min response time: 2ms
Max response time: 9ms
50th percentile: 6ms
90th percentile: 8ms
++++++++++++++++++++++++++++++++++++++++++++++++++
=== Stress Test Results ===
Total requests: 50
Successful requests: 50
Total test time: 13ms
Requests per second: 3846.153846153846
Average response time: 7.98ms
Min response time: 3ms
Max response time: 10ms
50th percentile: 8ms
90th percentile: 9ms
++++++++++++++++++++++++++++++++++++++++++++++++++
request failed: Connection refused: connect
=== Stress Test Results ===
Total requests: 60
Successful requests: 59
Total test time: 14ms
Requests per second: 4214.285714285715
Average response time: 7.067796610169491ms
Min response time: 3ms
Max response time: 10ms
50th percentile: 7ms
90th percentile: 10ms
++++++++++++++++++++++++++++++++++++++++++++++++++
```

每个线程生成请求数为50时，测试环境接近阈值， 最高rps（request per second)约为4000

### 动态路由测试结果

```text
++++++++++++++++++++++++++++++++++++++++++++++++++
run all tests:org.example.web.WebClientStressTest
--------------------------------------------------
--------------------------------------------------
=== Stress Test Results ===
Total requests: 10
Successful requests: 10
Total test time: 5ms
Requests per second: 2000.0
Average response time: 4.0ms
Min response time: 3ms
Max response time: 5ms
50th percentile: 4ms
90th percentile: 5ms
++++++++++++++++++++++++++++++++++++++++++++++++++
=== Stress Test Results ===
Total requests: 20
Successful requests: 20
Total test time: 12ms
Requests per second: 1666.6666666666667
Average response time: 7.65ms
Min response time: 6ms
Max response time: 11ms
50th percentile: 8ms
90th percentile: 10ms
++++++++++++++++++++++++++++++++++++++++++++++++++
=== Stress Test Results ===
Total requests: 30
Successful requests: 30
Total test time: 8ms
Requests per second: 3750.0
Average response time: 4.3ms
Min response time: 2ms
Max response time: 6ms
50th percentile: 4ms
90th percentile: 5ms
++++++++++++++++++++++++++++++++++++++++++++++++++
=== Stress Test Results ===
Total requests: 40
Successful requests: 40
Total test time: 11ms
Requests per second: 3636.3636363636365
Average response time: 6.25ms
Min response time: 2ms
Max response time: 9ms
50th percentile: 7ms
90th percentile: 8ms
++++++++++++++++++++++++++++++++++++++++++++++++++
=== Stress Test Results ===
Total requests: 50
Successful requests: 50
Total test time: 16ms
Requests per second: 3125.0
Average response time: 10.44ms
Min response time: 3ms
Max response time: 14ms
50th percentile: 11ms
90th percentile: 13ms
++++++++++++++++++++++++++++++++++++++++++++++++++
request failed: Connection refused: connect
request failed: Connection refused: connect
=== Stress Test Results ===
Total requests: 60
Successful requests: 58
Total test time: 10ms
Requests per second: 5800.0
Average response time: 5.293103448275862ms
Min response time: 3ms
Max response time: 7ms
50th percentile: 5ms
90th percentile: 6ms
++++++++++++++++++++++++++++++++++++++++++++++++++
```

每个线程生成请求数为30~40左右时， 测试环境接近阈值， 最高rps约为3600左右。